---
// src/pages/blog/index.astro
import { getCollection } from 'astro:content';
import type { GetStaticPaths, Page } from 'astro';
import type { CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const allPosts = await getCollection('blog', ({ data }) => {
    return import.meta.env.PROD ? data.draft !== true : true;
  });
  
  const sortedPosts = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

  return paginate(sortedPosts, { pageSize: 10 });
}

interface Props {
  page: Page<CollectionEntry<'blog'>>;
}

const { page } = Astro.props;
---

<BaseLayout title="Blog">
  <h1>Blog Posts</h1>
  <ul>
    {page.data.map((post) => (
      <li>
        {post.data.image && <img src={post.data.image} alt={post.data.title} width="50" height="50" />}
        <a href={`/blog/${post.slug}`}>{post.data.title}</a>
        <span> - {post.data.date.toLocaleDateString()}</span>
      </li>
    ))}
  </ul>

  <nav>
    {page.url.prev ? <a href={page.url.prev}>Previous</a> : null}
    {page.url.next ? <a href={page.url.next}>Next</a> : null}
  </nav>
</BaseLayout>
